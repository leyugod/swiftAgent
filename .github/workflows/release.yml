name: Release

on:
  push:
    tags:
      - 'v*.*.*'
  workflow_dispatch:

jobs:
  create-release:
    name: Create Release
    runs-on: macos-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: latest-stable
        
    - name: Build
      run: swift build -c release
      
    - name: Run tests
      run: swift test
      
    - name: Create Release
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ github.ref }}
        release_name: Release ${{ github.ref }}
        draft: false
        prerelease: false
        body: |
          ## What's Changed
          
          Please see the CHANGELOG.md for details.
          
          ## Installation
          
          Add SwiftAgent to your `Package.swift`:
          
          ```swift
          dependencies: [
              .package(url: "https://github.com/your-org/swiftAgent.git", from: "${{ github.ref_name }}")
          ]
          ```

