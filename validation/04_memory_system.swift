#!/usr/bin/env swift

/*
 éªŒè¯è„šæœ¬ 04: è®°å¿†ç³»ç»ŸéªŒè¯
 
 éªŒè¯å†…å®¹ï¼š
 - InMemoryStore CRUDæ“ä½œ
 - MemoryManager ä¸‰ç§è®°å¿†ç±»å‹
 - å‘é‡æœç´¢åŠŸèƒ½
 - è®°å¿†æ£€ç´¢å‡†ç¡®æ€§
*/

import Foundation

print("""
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ§ª éªŒè¯è„šæœ¬ 04: è®°å¿†ç³»ç»ŸéªŒè¯
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ éªŒè¯é¡¹ç›®æ¸…å•ï¼š

1ï¸âƒ£ InMemoryStore CRUD
   â–¡ æ·»åŠ è®°å¿†æ¡ç›®
   â–¡ æ£€ç´¢è®°å¿†
   â–¡ æ›´æ–°è®°å¿†
   â–¡ åˆ é™¤è®°å¿†
   â–¡ æ¸…ç©ºæ‰€æœ‰è®°å¿†

2ï¸âƒ£ MemoryManager ä¸‰ç§è®°å¿†
   â–¡ çŸ­æœŸè®°å¿† (Short-term)
   â–¡ é•¿æœŸè®°å¿† (Long-term)
   â–¡ å·¥ä½œè®°å¿† (Working)
   â–¡ è·¨ç±»å‹æœç´¢

3ï¸âƒ£ å‘é‡æœç´¢
   â–¡ æ·»åŠ å¸¦ embedding çš„è®°å¿†
   â–¡ å‘é‡ç›¸ä¼¼åº¦æœç´¢
   â–¡ ç›¸ä¼¼åº¦æ’åº
   â–¡ Top-K æ£€ç´¢

4ï¸âƒ£ è®°å¿†æ£€ç´¢
   â–¡ å…³é”®è¯æœç´¢
   â–¡ è¯­ä¹‰æœç´¢
   â–¡ æ—¶é—´èŒƒå›´è¿‡æ»¤
   â–¡ å…ƒæ•°æ®è¿‡æ»¤

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ éªŒè¯æ­¥éª¤ï¼š

### æ­¥éª¤ 1: è¿è¡Œè®°å¿†ç³»ç»Ÿå•å…ƒæµ‹è¯•
```bash
swift test --filter MemoryTests
```

é¢„æœŸç»“æœï¼š
- âœ… testAddMemory: é€šè¿‡
- âœ… testAddBatchMemories: é€šè¿‡
- âœ… testGetNonexistentMemory: é€šè¿‡
- âœ… testSearchMemories: é€šè¿‡
- âœ… testSearchWithLimit: é€šè¿‡
- âœ… testUpdateMemory: é€šè¿‡
- âœ… testDeleteMemory: é€šè¿‡
- âœ… testClearAllMemories: é€šè¿‡
- âœ… testVectorSearch: é€šè¿‡

### æ­¥éª¤ 2: MemoryManager æµ‹è¯•
```bash
swift test --filter testMemoryManagerCreation
swift test --filter testAddToShortTermMemory
swift test --filter testAddToLongTermMemory
swift test --filter testSearchAcrossMemories
swift test --filter testClearShortTermMemory
```

é¢„æœŸç»“æœï¼š
- âœ… çŸ­æœŸè®°å¿†æ·»åŠ å’Œæ£€ç´¢
- âœ… é•¿æœŸè®°å¿†æŒä¹…åŒ–
- âœ… å·¥ä½œè®°å¿†ç®¡ç†
- âœ… è·¨ç±»å‹æœç´¢
- âœ… å®¹é‡ç®¡ç†

### æ­¥éª¤ 3: å‘é‡æœç´¢éªŒè¯
```bash
swift test --filter testVectorSearch
```

é¢„æœŸç»“æœï¼š
- âœ… ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—æ­£ç¡®
- âœ… ç›¸ä¼¼åº¦æ’åºæ­£ç¡®
- âœ… Top-K æ£€ç´¢å‡†ç¡®
- âœ… å®Œå…¨åŒ¹é…ä¼˜å…ˆ

æµ‹è¯•æ•°æ®ï¼š
```
Entry 1: embedding [1.0, 0.0, 0.0]
Entry 2: embedding [0.9, 0.1, 0.0]
Entry 3: embedding [0.0, 1.0, 0.0]

Query: [1.0, 0.0, 0.0]

Expected results:
1. Entry 1 (ç›¸ä¼¼åº¦: 1.0)
2. Entry 2 (ç›¸ä¼¼åº¦: 0.9+)
3. Entry 3 (ç›¸ä¼¼åº¦: 0.0)
```

### æ­¥éª¤ 4: RAG åŠŸèƒ½æµ‹è¯•
```bash
swift test --filter testRAGBasicFunctionality
```

é¢„æœŸç»“æœï¼š
- âœ… æ–‡æ¡£æ·»åŠ åˆ°å‘é‡å­˜å‚¨
- âœ… æŸ¥è¯¢æ£€ç´¢ç›¸å…³æ–‡æ¡£
- âœ… ç›¸å…³æ€§æ’åºæ­£ç¡®
- âœ… ä¸Šä¸‹æ–‡å¢å¼º

### æ­¥éª¤ 5: å¹¶å‘å®‰å…¨æµ‹è¯•
```bash
swift test --filter testConcurrentMemoryAccess
swift test --filter testConcurrentVectorStoreAccess
```

é¢„æœŸç»“æœï¼š
- âœ… å¹¶å‘æ·»åŠ æ— æ•°æ®ä¸¢å¤±
- âœ… å¹¶å‘è¯»å–æ­£ç¡®
- âœ… æ— æ•°æ®ç«äº‰
- âœ… Actor éš”ç¦»ç”Ÿæ•ˆ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… éªŒè¯é€šè¿‡æ ‡å‡†ï¼š
   â€¢ InMemoryStore CRUD å…¨éƒ¨é€šè¿‡
   â€¢ ä¸‰ç§è®°å¿†ç±»å‹æ­£ç¡®ç®¡ç†
   â€¢ å‘é‡æœç´¢å‡†ç¡®æœ‰æ•ˆ
   â€¢ æ£€ç´¢ç»“æœç›¸å…³æ€§é«˜
   â€¢ å¹¶å‘è®¿é—®å®‰å…¨

âŒ å¤±è´¥æ ‡å‡†ï¼š
   â€¢ CRUD æ“ä½œå¤±è´¥
   â€¢ è®°å¿†ç±»å‹æ··æ·†
   â€¢ å‘é‡æœç´¢ç»“æœé”™è¯¯
   â€¢ ç›¸ä¼¼åº¦è®¡ç®—é”™è¯¯
   â€¢ å¹¶å‘å¯¼è‡´æ•°æ®æŸå

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ¯ è®°å¿†ç³»ç»Ÿæ€§èƒ½åŸºå‡†ï¼š

â–¡ æ·»åŠ è®°å¿†: < 1ms
â–¡ æ£€ç´¢è®°å¿†: < 5ms
â–¡ å‘é‡æœç´¢ (1000æ¡): < 50ms
â–¡ æ‰¹é‡æ·»åŠ  (100æ¡): < 100ms
â–¡ å†…å­˜å ç”¨: < 10MB (1000æ¡è®°å¿†)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
""")
